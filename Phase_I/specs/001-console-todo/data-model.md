# Data Model: Phase I - In-Memory Console Todo Application

**Feature**: 001-console-todo
**Date**: 2026-01-08
**Purpose**: Define the TodoItem entity with validation rules and state transitions

## Entity: TodoItem

### Overview

The TodoItem represents a single task in the todo list. It is the core domain entity of the application, containing all information needed to track a task from creation to completion.

### Attributes

| Attribute | Type | Required | Default | Constraints | Description |
|-----------|------|----------|---------|-------------|-------------|
| `id` | `int` | Yes | Auto-generated | Positive integer, unique | Unique identifier for the todo item |
| `title` | `str` | Yes | None | 1-500 characters, non-empty after trim | The main text describing the task |
| `description` | `str` | No | Empty string | 0-2000 characters | Optional detailed description of the task |
| `completed` | `bool` | No | `False` | Boolean | Whether the task has been completed |
| `created_at` | `datetime` | No | Current timestamp | Valid datetime | When the todo was created |

### Validation Rules

#### Title Validation
- **MUST NOT** be empty or contain only whitespace
- **MUST** be between 1 and 500 characters after trimming
- **SHOULD** be trimmed of leading/trailing whitespace on creation
- **MAY** contain any Unicode characters including special characters
- **Error**: Raise `ValueError` with message "Title cannot be empty or whitespace only"

#### Description Validation
- **MAY** be empty (optional field)
- **MUST NOT** exceed 2000 characters
- **MAY** contain any Unicode characters including newlines
- **Error**: Raise `ValueError` with message "Description cannot exceed 2000 characters"

#### ID Validation
- **MUST** be a positive integer
- **MUST** be unique within the store
- **MUST** be auto-generated by the store (not user-provided)
- **Error**: Raise `ValueError` with message "ID must be a positive integer"

#### Completed Validation
- **MUST** be a boolean value (`True` or `False`)
- **MUST** default to `False` on creation
- **Error**: Raise `TypeError` with message "Completed must be a boolean value"

#### Created At Validation
- **MUST** be a valid datetime object
- **MUST** default to current timestamp on creation
- **MUST NOT** be modifiable after creation (immutable)
- **Error**: Raise `TypeError` with message "Created_at must be a datetime object"

### State Transitions

```
┌─────────────────────────────────────────────────────────────┐
│                    TodoItem Lifecycle                        │
└─────────────────────────────────────────────────────────────┘

[Created] ──────────────────────────────────────────────────┐
   │                                                         │
   │ Initial State: completed = False                        │
   │                                                         │
   ▼                                                         │
[Pending] ◄──────────────────────────────────────────────┐  │
   │                                                      │  │
   │ mark_complete()                                      │  │
   │                                                      │  │
   ▼                                                      │  │
[Completed]                                               │  │
   │                                                      │  │
   │ mark_incomplete()                                    │  │
   │                                                      │  │
   └──────────────────────────────────────────────────────┘  │
                                                             │
   Any State ──────────────────────────────────────────────┐│
   │                                                        ││
   │ update_title() / update_description()                 ││
   │                                                        ││
   └────────────────────────────────────────────────────────┘│
                                                             │
   Any State ──────────────────────────────────────────────┐│
   │                                                        ││
   │ delete()                                              ││
   │                                                        ││
   ▼                                                        ││
[Deleted] ──────────────────────────────────────────────────┘│
   │                                                         │
   │ (Removed from store, no longer accessible)             │
   │                                                         │
   └─────────────────────────────────────────────────────────┘
```

### State Transition Rules

1. **Creation**: New todos start in Pending state (`completed = False`)
2. **Mark Complete**: Pending → Completed (`completed = True`)
3. **Mark Incomplete**: Completed → Pending (`completed = False`)
4. **Update**: Can update title/description in any state (Pending or Completed)
5. **Delete**: Can delete from any state, permanently removes from store

### Pydantic Model Implementation

```python
from pydantic import BaseModel, Field, field_validator
from datetime import datetime
from typing import Optional

class TodoItem(BaseModel):
    """
    Represents a single todo item in the application.

    Attributes:
        id: Unique identifier for the todo
        title: Main task description (required, 1-500 chars)
        description: Optional detailed description (0-2000 chars)
        completed: Whether the task is completed (default: False)
        created_at: Timestamp when the todo was created
    """

    id: int = Field(..., gt=0, description="Unique positive integer identifier")
    title: str = Field(..., min_length=1, max_length=500, description="Task title")
    description: str = Field(default="", max_length=2000, description="Optional task description")
    completed: bool = Field(default=False, description="Completion status")
    created_at: datetime = Field(default_factory=datetime.now, description="Creation timestamp")

    @field_validator('title')
    @classmethod
    def title_not_empty(cls, v: str) -> str:
        """Validate that title is not empty or whitespace only."""
        if not v.strip():
            raise ValueError('Title cannot be empty or whitespace only')
        return v.strip()

    @field_validator('description')
    @classmethod
    def description_length(cls, v: str) -> str:
        """Validate that description does not exceed maximum length."""
        if len(v) > 2000:
            raise ValueError('Description cannot exceed 2000 characters')
        return v

    class Config:
        """Pydantic model configuration."""
        frozen = False  # Allow mutation for updates
        validate_assignment = True  # Validate on attribute assignment
        json_schema_extra = {
            "example": {
                "id": 1,
                "title": "Buy groceries",
                "description": "Milk, eggs, bread",
                "completed": False,
                "created_at": "2026-01-08T10:30:00"
            }
        }
```

### Usage Examples

#### Creating a TodoItem

```python
# Valid creation
todo = TodoItem(
    id=1,
    title="Buy groceries",
    description="Milk, eggs, bread"
)

# Valid creation with minimal fields
todo = TodoItem(id=2, title="Call dentist")

# Invalid creation - empty title
try:
    todo = TodoItem(id=3, title="   ")
except ValueError as e:
    print(e)  # "Title cannot be empty or whitespace only"

# Invalid creation - title too long
try:
    todo = TodoItem(id=4, title="x" * 501)
except ValueError as e:
    print(e)  # Validation error for max_length
```

#### Updating a TodoItem

```python
# Update title
todo.title = "Buy groceries and supplies"

# Update description
todo.description = "Milk, eggs, bread, butter"

# Mark as complete
todo.completed = True

# Mark as incomplete
todo.completed = False

# Invalid update - empty title
try:
    todo.title = ""
except ValueError as e:
    print(e)  # "Title cannot be empty or whitespace only"
```

### Serialization

#### JSON Serialization

```python
# To JSON
todo_json = todo.model_dump_json()
# {"id": 1, "title": "Buy groceries", "description": "Milk, eggs, bread", "completed": false, "created_at": "2026-01-08T10:30:00"}

# From JSON
todo = TodoItem.model_validate_json(todo_json)
```

#### Dictionary Serialization

```python
# To dict
todo_dict = todo.model_dump()
# {'id': 1, 'title': 'Buy groceries', 'description': 'Milk, eggs, bread', 'completed': False, 'created_at': datetime(...)}

# From dict
todo = TodoItem.model_validate(todo_dict)
```

### Edge Cases

| Edge Case | Expected Behavior | Validation |
|-----------|-------------------|------------|
| Empty title | Raise ValueError | `title_not_empty` validator |
| Whitespace-only title | Raise ValueError | `title_not_empty` validator |
| Title with 500 characters | Accept | Within max_length |
| Title with 501 characters | Raise ValueError | Pydantic max_length validation |
| Empty description | Accept (default) | Optional field |
| Description with 2000 characters | Accept | Within max_length |
| Description with 2001 characters | Raise ValueError | `description_length` validator |
| Special characters in title | Accept | Unicode support |
| Newlines in description | Accept | Multiline support |
| Negative ID | Raise ValueError | Pydantic gt=0 validation |
| Zero ID | Raise ValueError | Pydantic gt=0 validation |
| Non-boolean completed | Raise TypeError | Pydantic type validation |
| Invalid datetime | Raise TypeError | Pydantic type validation |

### Relationships

**TodoItem has no relationships in Phase I** (single entity, in-memory storage).

In future phases:
- Phase II: TodoItem → User (many-to-one)
- Phase III: TodoItem → AIContext (one-to-many for chatbot interactions)

### Invariants

1. **ID Uniqueness**: No two TodoItems can have the same ID within a store
2. **Title Non-Empty**: Title must always contain at least one non-whitespace character
3. **Immutable Creation Time**: `created_at` cannot be changed after creation
4. **Boolean Completion**: `completed` must always be a boolean value

### Testing Requirements

#### Unit Tests Required

1. **Creation Tests**:
   - Valid creation with all fields
   - Valid creation with minimal fields (title only)
   - Invalid creation with empty title
   - Invalid creation with whitespace-only title
   - Invalid creation with title exceeding max length
   - Invalid creation with description exceeding max length

2. **Validation Tests**:
   - Title trimming (leading/trailing whitespace removed)
   - Special characters in title (unicode, quotes, etc.)
   - Newlines in description
   - Edge case lengths (exactly at limits)

3. **State Transition Tests**:
   - Mark as complete (False → True)
   - Mark as incomplete (True → False)
   - Update title while pending
   - Update title while completed
   - Update description in any state

4. **Serialization Tests**:
   - JSON serialization/deserialization
   - Dictionary serialization/deserialization
   - Datetime handling in serialization

### Performance Considerations

- **Memory**: Each TodoItem ~200-500 bytes (depending on title/description length)
- **Validation**: O(1) for all validations (string length checks)
- **Serialization**: O(n) where n is total string length
- **Target**: Support 100+ TodoItems in memory without degradation

### Security Considerations

- **Input Sanitization**: Title and description are validated but not sanitized (no HTML/SQL injection risk in Phase I)
- **Length Limits**: Prevent memory exhaustion attacks via excessively long strings
- **Type Safety**: Pydantic ensures type correctness, preventing type confusion attacks

---

## Summary

The TodoItem entity is a simple, well-validated domain model that serves as the foundation for the todo application. It uses Pydantic for robust validation, supports all required CRUD operations, and maintains clear state transitions. The model is designed for simplicity and correctness, aligning with Phase I constitution principles.
