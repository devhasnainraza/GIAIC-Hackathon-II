# Implementation Plan: Frontend Application & User Experience

**Branch**: `003-frontend-ux` | **Date**: 2026-01-09 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/003-frontend-ux/spec.md`

## Summary

This plan implements a Next.js 16+ frontend application for the Todo Full-Stack Web Application, emphasizing **official CLI initialization** as the foundation for all development. The frontend will provide user authentication (signup/signin/logout), task management UI (CRUD operations), secure API integration with JWT tokens, and responsive design for mobile and desktop devices.

**Critical Requirement**: The Next.js project MUST be initialized using the official CLI command (`npx create-next-app@latest`) before any code implementation. No manual directory creation is permitted.

**Technical Approach**:
1. Initialize Next.js project using official CLI with TypeScript, ESLint, Tailwind CSS, and App Router
2. Implement Better Auth for JWT-based authentication
3. Create centralized API client with automatic JWT attachment
4. Build authentication UI (signup, signin, logout)
5. Build task management UI (list, create, edit, delete, complete)
6. Implement responsive design and error handling
7. Verify end-to-end functionality

## Technical Context

**Language/Version**: TypeScript 5.x with Next.js 16+
**Primary Dependencies**: Next.js 16+, Better Auth, Tailwind CSS, React 18+
**Storage**: Backend API (FastAPI) with PostgreSQL (no frontend-side persistence)
**Testing**: Manual verification against acceptance criteria (automated tests out of scope)
**Target Platform**: Web browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
**Project Type**: Web application (frontend only, consumes existing backend API)
**Performance Goals**: <3s initial page load, <500ms task list rendering, <100ms UI feedback
**Constraints**: Must use official CLI initialization, no manual scaffolding, backend API as single source of truth
**Scale/Scope**: Single-user frontend, ~10 pages/components, responsive design (320px-2560px)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### ✅ I. Correctness & Specification Adherence
- All 40 functional requirements from spec.md will be implemented exactly as specified
- Each user story has defined acceptance scenarios that will be verified
- No deviation from specified behavior without explicit clarification
- **Status**: PASS - Specification is complete and unambiguous

### ✅ II. Security-First Design
- JWT tokens will be stored securely (httpOnly cookies)
- All API requests will include Authorization header with JWT token
- No secrets or tokens will be hardcoded in source code
- Environment variables will be used for API URLs and configuration
- **Status**: PASS - Security requirements clearly defined

### ✅ III. User Data Isolation
- Frontend will rely entirely on backend enforcement of data isolation
- User ID will never be provided by frontend (extracted from JWT by backend)
- All task operations will go through backend API (no client-side bypass)
- **Status**: PASS - Backend API (Spec 2) enforces isolation; frontend respects this

### ✅ IV. Agentic Development Workflow
- This plan follows Spec → Plan → Tasks → Implementation workflow
- All code will be generated through Claude Code agents
- PHRs will be created for all development sessions
- **Status**: PASS - Following required workflow

### ✅ V. Technology Stack Immutability
- Next.js 16+ with App Router (required) ✓
- Better Auth with JWT (required) ✓
- TypeScript (required) ✓
- Tailwind CSS (required) ✓
- **Status**: PASS - Stack matches requirements exactly

### ✅ VI. Quality & Reproducibility
- Official CLI initialization ensures reproducible project structure
- All workflows will be traceable through prompts
- Loading, error, and empty states will be implemented
- Responsive design for mobile and desktop
- **Status**: PASS - Quality standards defined in spec

**Overall Gate Status**: ✅ PASS - All constitution principles satisfied

## Project Structure

### Documentation (this feature)

```text
specs/003-frontend-ux/
├── spec.md              # Feature specification (complete)
├── plan.md              # This file (implementation plan)
├── research.md          # Phase 0 output (to be created)
├── data-model.md        # Phase 1 output (to be created)
├── quickstart.md        # Phase 1 output (to be created)
├── contracts/           # Phase 1 output (to be created)
│   ├── frontend-routes.md
│   ├── component-hierarchy.md
│   └── api-client-interface.md
└── tasks.md             # Phase 2 output (/sp.tasks command)
```

### Source Code (repository root)

```text
E:/Hackathon_II/Phase_II/
├── backend/             # Existing backend (Spec 2)
│   ├── src/
│   │   ├── models/
│   │   ├── services/
│   │   └── api/
│   └── tests/
│
└── frontend/            # NEW - To be created by npx create-next-app@latest
    ├── app/             # Next.js App Router (generated by CLI)
    │   ├── layout.tsx
    │   ├── page.tsx
    │   ├── (auth)/      # Auth routes group (to be created)
    │   │   ├── signup/
    │   │   └── signin/
    │   └── (dashboard)/ # Protected routes group (to be created)
    │       └── tasks/
    ├── components/      # Reusable components (to be created)
    │   ├── ui/
    │   ├── auth/
    │   └── tasks/
    ├── lib/             # Utilities and services (to be created)
    │   ├── auth.ts      # Better Auth configuration
    │   ├── api-client.ts
    │   └── types.ts
    ├── public/          # Static assets (generated by CLI)
    ├── .env.local       # Environment variables (to be created)
    ├── next.config.js   # Next.js configuration (generated by CLI)
    ├── tailwind.config.js # Tailwind configuration (generated by CLI)
    ├── tsconfig.json    # TypeScript configuration (generated by CLI)
    └── package.json     # Dependencies (generated by CLI)
```

**Structure Decision**: Web application with separate frontend and backend directories. The frontend will be created using the official Next.js CLI in the `E:/Hackathon_II/Phase_II/frontend` directory. The CLI will generate the base structure (app/, public/, configuration files), and we will extend it with authentication, API client, and task management features.

## Complexity Tracking

> **No violations to justify** - This implementation follows standard Next.js patterns and constitution principles.

---

## Phase 0: Research & Technical Decisions

**Objective**: Research Next.js 16+ App Router patterns, Better Auth integration, and API client architecture to resolve all technical unknowns before implementation.

### Research Tasks

#### R1: Next.js 16+ App Router Patterns

**Question**: What are the best practices for organizing routes, layouts, and route groups in Next.js 16+ App Router?

**Research Focus**:
- App Router directory structure conventions
- Route groups for authentication vs. protected routes
- Layout composition and nesting
- Loading and error boundaries
- Metadata and SEO configuration

**Decision Criteria**:
- Must support both public (auth) and protected (dashboard) routes
- Must enable shared layouts for route groups
- Must follow Next.js official documentation patterns

#### R2: Better Auth Integration with Next.js

**Question**: How should Better Auth be configured for JWT-based authentication in Next.js 16+ with App Router?

**Research Focus**:
- Better Auth installation and configuration
- JWT plugin setup for 7-day token expiration
- Token storage options (httpOnly cookies vs. localStorage)
- Integration with Next.js middleware for route protection
- Session management and token refresh patterns

**Decision Criteria**:
- Must match backend JWT configuration (HS256, 7-day expiration)
- Must store tokens securely (httpOnly cookies preferred)
- Must integrate with App Router middleware

#### R3: API Client Architecture

**Question**: What is the best pattern for a centralized API client that automatically attaches JWT tokens and handles errors?

**Research Focus**:
- Fetch API wrapper patterns
- Automatic JWT token attachment from cookies/storage
- Error handling and retry logic
- TypeScript type safety for API responses
- Request/response interceptor patterns

**Decision Criteria**:
- Must automatically include Authorization header
- Must handle 401 errors with redirect to signin
- Must provide type-safe API methods
- Must centralize error handling

#### R4: Form Handling and Validation

**Question**: What is the recommended approach for form handling and validation in Next.js App Router?

**Research Focus**:
- React Hook Form vs. native form handling
- Client-side validation patterns
- Server Actions vs. API routes for form submission
- Error message display patterns
- Loading state management during submission

**Decision Criteria**:
- Must provide immediate user feedback
- Must validate before API submission
- Must handle async submission states
- Must display inline error messages

#### R5: Responsive Design with Tailwind CSS

**Question**: What are the best practices for responsive design in Next.js using Tailwind CSS?

**Research Focus**:
- Mobile-first breakpoint strategy
- Responsive component patterns
- Touch-friendly UI elements (44x44px minimum)
- Tailwind responsive utilities
- Dark mode considerations (out of scope, but good to know)

**Decision Criteria**:
- Must support 320px-2560px screen widths
- Must use mobile-first approach
- Must provide touch-friendly controls on mobile

#### R6: State Management Strategy

**Question**: What state management approach is appropriate for this application's scope?

**Research Focus**:
- React Context vs. Zustand vs. Redux
- Server state vs. client state
- When to use React Server Components vs. Client Components
- Optimistic UI updates vs. server-driven updates

**Decision Criteria**:
- Must keep backend as single source of truth
- Must not cache sensitive data insecurely
- Must be simple enough for application scope
- Must support loading/error states

### Research Output

**Deliverable**: `research.md` containing:
- Decision for each research question
- Rationale for chosen approach
- Alternatives considered and why rejected
- Code examples or patterns to follow
- Links to official documentation

**Acceptance Criteria**:
- All 6 research questions answered with concrete decisions
- Each decision includes rationale and alternatives
- No "NEEDS CLARIFICATION" markers remain
- Decisions align with constitution principles

---

## Phase 1: Design & Contracts

**Prerequisites**: `research.md` complete with all technical decisions made

### Design Tasks

#### D1: Data Model Documentation

**Objective**: Document the frontend data models and their relationship to backend API responses.

**Input**: Backend API contracts from Spec 2 (auth-api.yaml, tasks-api.yaml)

**Output**: `data-model.md` containing:

```markdown
# Frontend Data Models

## User Model (from API)
- id: number
- email: string
- created_at: string (ISO 8601)

## Task Model (from API)
- id: number
- user_id: number
- title: string (1-200 chars)
- description: string | null (max 2000 chars)
- is_complete: boolean
- created_at: string (ISO 8601)
- updated_at: string (ISO 8601)

## Authentication Token (JWT)
- Stored in: httpOnly cookie
- Claims: sub (user_id), email, exp, iat
- Expiration: 7 days
- Algorithm: HS256

## Form Models (client-side)
- SignupForm: { email: string, password: string }
- SigninForm: { email: string, password: string }
- TaskCreateForm: { title: string, description?: string }
- TaskUpdateForm: { title?: string, description?: string, is_complete?: boolean }

## API Response Types
- AuthResponse: { user: User, token: string }
- TaskResponse: Task
- TaskListResponse: Task[]
- ErrorResponse: { error: string }
```

**Acceptance Criteria**:
- All models match backend API contracts exactly
- TypeScript interfaces defined for type safety
- Form models include validation rules
- API response types documented

#### D2: Frontend Routes Contract

**Objective**: Define all frontend routes and their authentication requirements.

**Output**: `contracts/frontend-routes.md` containing:

```markdown
# Frontend Routes

## Public Routes (no authentication required)
- `/` - Landing page (redirects to /signin if not authenticated, /tasks if authenticated)
- `/signin` - Sign in page
- `/signup` - Sign up page

## Protected Routes (authentication required)
- `/tasks` - Task list and management dashboard
- `/tasks/new` - Create new task (optional, can be modal on /tasks)
- `/tasks/[id]/edit` - Edit task (optional, can be modal on /tasks)

## API Routes (Next.js API routes for Better Auth)
- `/api/auth/register` - Better Auth registration endpoint
- `/api/auth/login` - Better Auth login endpoint
- `/api/auth/logout` - Better Auth logout endpoint

## Route Protection
- Middleware checks for JWT token in cookies
- Unauthenticated users redirected to /signin
- Authenticated users accessing /signin or /signup redirected to /tasks
```

**Acceptance Criteria**:
- All routes defined with authentication requirements
- Route protection strategy documented
- Redirect logic specified

#### D3: Component Hierarchy

**Objective**: Define the component structure and reusability strategy.

**Output**: `contracts/component-hierarchy.md` containing:

```markdown
# Component Hierarchy

## Layout Components
- `app/layout.tsx` - Root layout (global styles, fonts)
- `app/(auth)/layout.tsx` - Auth pages layout (centered form)
- `app/(dashboard)/layout.tsx` - Dashboard layout (header with logout)

## Page Components
- `app/(auth)/signin/page.tsx` - Sign in page
- `app/(auth)/signup/page.tsx` - Sign up page
- `app/(dashboard)/tasks/page.tsx` - Task list page

## Reusable Components
- `components/auth/SigninForm.tsx` - Sign in form
- `components/auth/SignupForm.tsx` - Sign up form
- `components/tasks/TaskList.tsx` - Task list display
- `components/tasks/TaskItem.tsx` - Individual task item
- `components/tasks/TaskForm.tsx` - Create/edit task form
- `components/ui/Button.tsx` - Reusable button
- `components/ui/Input.tsx` - Reusable input field
- `components/ui/ErrorMessage.tsx` - Error display
- `components/ui/LoadingSpinner.tsx` - Loading indicator
- `components/ui/EmptyState.tsx` - Empty state message

## Component Responsibilities
- Page components: Data fetching, layout, composition
- Form components: User input, validation, submission
- UI components: Presentation, styling, accessibility
- Layout components: Shared structure, navigation
```

**Acceptance Criteria**:
- Component hierarchy supports all user stories
- Clear separation of concerns
- Reusable components identified
- Responsive design considerations included

#### D4: API Client Interface

**Objective**: Define the API client interface and methods.

**Output**: `contracts/api-client-interface.md` containing:

```markdown
# API Client Interface

## Configuration
- Base URL: process.env.NEXT_PUBLIC_API_URL (http://localhost:8000)
- Token source: httpOnly cookie (automatic)
- Error handling: Centralized with user-friendly messages

## Authentication Methods
- `auth.signup(email, password)` → Promise<AuthResponse>
- `auth.signin(email, password)` → Promise<AuthResponse>
- `auth.logout()` → Promise<void>

## Task Methods
- `tasks.list()` → Promise<Task[]>
- `tasks.get(id)` → Promise<Task>
- `tasks.create(data)` → Promise<Task>
- `tasks.update(id, data)` → Promise<Task>
- `tasks.delete(id)` → Promise<void>
- `tasks.toggleComplete(id, isComplete)` → Promise<Task>

## Error Handling
- 401 Unauthorized → Clear session, redirect to /signin
- 403 Forbidden → Show "Access denied" message
- 404 Not Found → Show "Resource not found" message
- 500 Server Error → Show "Something went wrong, please try again"
- Network Error → Show "Connection lost, please check your internet"

## Type Safety
- All methods return typed promises
- Request/response types match backend API contracts
- Error types defined for consistent handling
```

**Acceptance Criteria**:
- All backend API endpoints covered
- Type-safe method signatures
- Error handling strategy defined
- Token attachment automatic

#### D5: Quickstart Guide

**Objective**: Create step-by-step guide for setting up and running the frontend.

**Output**: `quickstart.md` containing:

```markdown
# Frontend Quickstart Guide

## Prerequisites
- Node.js 18+ installed
- Backend API running at http://localhost:8000
- Backend database initialized with users and tasks tables

## Step 1: Initialize Next.js Project

```bash
cd E:/Hackathon_II/Phase_II
npx create-next-app@latest frontend --typescript --tailwind --app --eslint --no-src-dir --import-alias "@/*"
```

Options selected:
- TypeScript: Yes
- ESLint: Yes
- Tailwind CSS: Yes
- App Router: Yes
- Customize import alias: Yes (@/*)

## Step 2: Install Dependencies

```bash
cd frontend
npm install better-auth
```

## Step 3: Configure Environment Variables

Create `frontend/.env.local`:

```env
NEXT_PUBLIC_API_URL=http://localhost:8000
BETTER_AUTH_SECRET=your-secret-key-here
DATABASE_URL=postgresql://user:password@localhost:5432/todo_db
```

## Step 4: Configure Better Auth

Create `frontend/lib/auth.ts` with Better Auth configuration.

## Step 5: Implement API Client

Create `frontend/lib/api-client.ts` with centralized API methods.

## Step 6: Implement Authentication UI

Create signup and signin pages in `app/(auth)/` directory.

## Step 7: Implement Task Management UI

Create task list and management pages in `app/(dashboard)/tasks/` directory.

## Step 8: Run Development Server

```bash
npm run dev
```

Visit http://localhost:3000

## Verification Steps

1. Sign up with new email and password
2. Verify redirect to /tasks after signup
3. Sign out and sign in again
4. Create a new task
5. Edit the task
6. Mark task as complete
7. Delete the task
8. Verify responsive design on mobile (320px) and desktop (1920px)
```

**Acceptance Criteria**:
- Step-by-step instructions from CLI initialization to running app
- All commands provided with exact syntax
- Environment variables documented
- Verification steps included

### Agent Context Update

After completing design artifacts, update the agent context:

```bash
.specify/scripts/bash/update-agent-context.sh claude
```

This will add Next.js 16+, Better Auth, and Tailwind CSS to the technology stack in CLAUDE.md.

---

## Phase 2: Task Generation

**Prerequisites**: All Phase 1 design artifacts complete

**Command**: `/sp.tasks`

**Output**: `tasks.md` with atomic, testable tasks organized by user story

**Task Organization**:
1. **Phase 0: Project Initialization** (P1 - Official CLI)
   - T001: Run npx create-next-app@latest with specified options
   - T002: Verify generated project structure
   - T003: Install Better Auth dependency
   - T004: Configure environment variables

2. **Phase 1: Better Auth Setup** (P2 - Authentication Foundation)
   - T005: Configure Better Auth in lib/auth.ts
   - T006: Create authentication middleware
   - T007: Set up API routes for Better Auth

3. **Phase 2: API Client** (P4 - Secure Integration)
   - T008: Create centralized API client in lib/api-client.ts
   - T009: Implement automatic JWT attachment
   - T010: Implement error handling and retry logic
   - T011: Define TypeScript types for API responses

4. **Phase 3: Authentication UI** (P2 - User Authentication)
   - T012: Create signup page and form component
   - T013: Create signin page and form component
   - T014: Implement logout functionality
   - T015: Create route protection middleware
   - T016: Implement redirect logic for authenticated/unauthenticated users

5. **Phase 4: Task Management UI** (P3 - Core Functionality)
   - T017: Create task list page
   - T018: Implement task list component with loading/error/empty states
   - T019: Create task form component (create/edit)
   - T020: Implement create task functionality
   - T021: Implement edit task functionality
   - T022: Implement delete task functionality
   - T023: Implement toggle completion functionality

6. **Phase 5: UX Polish** (P5 - Responsive Design)
   - T024: Implement responsive design for mobile (320px-767px)
   - T025: Implement responsive design for tablet (768px-1023px)
   - T026: Implement responsive design for desktop (1024px+)
   - T027: Add loading states for all async operations
   - T028: Add error states with user-friendly messages
   - T029: Add empty states with helpful guidance

7. **Phase 6: Verification** (All Priorities)
   - T030: Verify signup flow end-to-end
   - T031: Verify signin flow end-to-end
   - T032: Verify task CRUD operations
   - T033: Verify user data isolation (create two users, verify separation)
   - T034: Verify responsive design on multiple screen sizes
   - T035: Verify error handling (401, 500, network errors)

**Acceptance Criteria for Task Generation**:
- Each task is atomic and independently testable
- Tasks reference specific files and components
- Tasks include acceptance criteria
- Tasks organized by user story priority
- Parallel execution opportunities identified

---

## Implementation Strategy

### Execution Order

1. **Phase 0: Project Initialization** (Sequential - must complete first)
   - Run official CLI command
   - Verify structure
   - Install dependencies
   - Configure environment

2. **Phase 1: Better Auth Setup** (Sequential - foundation for auth)
   - Configure Better Auth
   - Set up middleware
   - Create API routes

3. **Phase 2: API Client** (Sequential - foundation for all API calls)
   - Create API client
   - Implement JWT attachment
   - Implement error handling

4. **Phase 3 & 4: UI Implementation** (Can parallelize auth and tasks)
   - Authentication UI (signup, signin, logout)
   - Task Management UI (list, create, edit, delete, complete)

5. **Phase 5: UX Polish** (After core functionality)
   - Responsive design
   - Loading/error/empty states

6. **Phase 6: Verification** (Final validation)
   - End-to-end testing
   - User isolation verification
   - Responsive design verification

### Agent Assignment

- **Project Initialization**: General-purpose agent or Bash agent
- **Better Auth Setup**: `auth-security-specialist` agent
- **API Client**: `nextjs-ui-builder` agent
- **Authentication UI**: `nextjs-ui-builder` agent
- **Task Management UI**: `nextjs-ui-builder` agent
- **UX Polish**: `nextjs-ui-builder` agent
- **Verification**: General-purpose agent or manual testing

### Critical Success Factors

1. **Official CLI First**: The Next.js project MUST be initialized with the official CLI before any code is written
2. **No Manual Scaffolding**: Do not create app/, components/, or lib/ directories manually
3. **Backend as Truth**: All data must come from backend API, no client-side caching of sensitive data
4. **JWT Security**: Tokens must be stored securely and never exposed in logs or UI
5. **Reproducibility**: Every step must be traceable through prompts and PHRs

### Risk Mitigation

**Risk 1: Manual Directory Creation**
- **Mitigation**: First task explicitly runs CLI command and verifies structure
- **Verification**: Check git history to confirm CLI was used

**Risk 2: Token Exposure**
- **Mitigation**: Use httpOnly cookies, never log tokens, implement CSP headers
- **Verification**: Code review for console.log statements with tokens

**Risk 3: Backend API Unavailability**
- **Mitigation**: Implement health check, display maintenance message
- **Verification**: Test with backend stopped

**Risk 4: Responsive Design Issues**
- **Mitigation**: Mobile-first approach, test on real devices
- **Verification**: Test on 320px, 768px, 1024px, 1920px screens

---

## Constitution Re-Check (Post-Design)

### ✅ I. Correctness & Specification Adherence
- Design artifacts map directly to functional requirements
- All 40 functional requirements covered in component and route design
- **Status**: PASS

### ✅ II. Security-First Design
- JWT tokens stored in httpOnly cookies
- API client automatically attaches Authorization header
- No secrets in source code (environment variables)
- **Status**: PASS

### ✅ III. User Data Isolation
- Frontend relies on backend for data isolation enforcement
- No client-side user ID manipulation
- All operations go through backend API
- **Status**: PASS

### ✅ IV. Agentic Development Workflow
- Plan follows Spec → Plan → Tasks → Implementation workflow
- All tasks will be executed by specialized agents
- PHRs will document all development sessions
- **Status**: PASS

### ✅ V. Technology Stack Immutability
- Next.js 16+ with App Router ✓
- Better Auth with JWT ✓
- TypeScript ✓
- Tailwind CSS ✓
- **Status**: PASS

### ✅ VI. Quality & Reproducibility
- Official CLI initialization ensures reproducibility
- Component hierarchy supports maintainability
- Loading/error/empty states designed
- Responsive design planned
- **Status**: PASS

**Overall Gate Status**: ✅ PASS - All constitution principles satisfied after design

---

## Next Steps

1. **Complete Phase 0**: Create `research.md` by researching all 6 technical questions
2. **Complete Phase 1**: Create all design artifacts (data-model.md, contracts/, quickstart.md)
3. **Run `/sp.tasks`**: Generate atomic task breakdown from this plan
4. **Run `/sp.implement`**: Execute tasks using specialized agents
5. **Verify**: Test all acceptance criteria and user stories

**Plan Status**: ✅ COMPLETE - Ready for research phase

**Branch**: `003-frontend-ux`
**Plan File**: `E:/Hackathon_II/Phase_II/specs/003-frontend-ux/plan.md`
